<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soot Blower ì •ë¹„ ì‹œìŠ¤í…œ</title>
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§ ìœ í‹¸ë¦¬í‹°) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background-color: #f3f4f6; }
        
        /* í™”ë©´ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .page-section { display: none; animation: fadeIn 0.3s ease-in-out; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ëŒ€ì‹œë³´ë“œ ë¦¬ìŠ¤íŠ¸ ë²„íŠ¼ */
        .dashboard-btn { @apply w-full bg-white p-5 rounded-xl shadow-sm border-l-4 mb-3 flex justify-between items-center transition-all cursor-pointer hover:shadow-md hover:bg-gray-50; }
        .dashboard-btn.blue { border-left-color: #2563eb; }
        .dashboard-btn.red { border-left-color: #dc2626; }

        /* ë³´ì¼ëŸ¬ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (ê³µê°„ í™•ë³´) */
        .boiler-grid {
            display: grid;
            grid-template-columns: 90px 1fr 90px; /* ì¢Œìš° ë„ˆë¹„ ë„‰ë„‰í•˜ê²Œ */
            grid-template-rows: 90px 1fr 90px;    /* ìƒí•˜ ë†’ì´ ë„‰ë„‰í•˜ê²Œ */
            padding: 10px;
            background-color: #fff;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            position: relative;
            min-height: 550px;
        }
        .area-top { grid-column: 2 / 3; grid-row: 1 / 2; }
        .area-bottom { grid-column: 2 / 3; grid-row: 3 / 4; }
        .area-left { grid-column: 1 / 2; grid-row: 2 / 3; }
        .area-right { grid-column: 3 / 4; grid-row: 2 / 3; }
        .area-center { grid-column: 2 / 3; grid-row: 2 / 3; }

        .device-container { display: flex; justify-content: space-evenly; align-items: center; height: 100%; width: 100%; }
        /* ìœ„ì¹˜ë³„ ì •ë ¬ ë°©í–¥ */
        .area-top.device-container { flex-direction: row; align-items: flex-end; padding-bottom: 5px; }
        .area-bottom.device-container { flex-direction: row; align-items: flex-start; padding-top: 5px; }
        .area-left.device-container { flex-direction: column; align-items: flex-end; padding-right: 5px; }
        .area-right.device-container { flex-direction: column; align-items: flex-start; padding-left: 5px; }

        /* ê¸°ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ì‚¬ê° ë°•ìŠ¤) */
        .btn-device {
            width: 46px; height: 46px; /* í¬ê¸° ì•½ê°„ í™•ëŒ€ */
            background-color: white; border: 2px solid #374151; color: #111827;
            font-weight: 800; font-size: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.15s; z-index: 10; margin: 2px;
            border-radius: 6px; line-height: 1; overflow: hidden;
        }
        .btn-device:active { transform: scale(0.95); background-color: #e5e7eb; }
        .btn-device:hover { border-color: #2563eb; color: #2563eb; background-color: #eff6ff; transform: scale(1.1); }
        /* NS/NL ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .ns-label { font-size: 10px; font-weight: 600; margin-bottom: -2px; color: #4b5563; }
        .ns-number { font-size: 15px; font-weight: 900; }

        /* ì½”ë„ˆ ê°€ì´ë“œ (ë°°ê²½ ìˆ«ì) */
        .corner-guide { position: absolute; font-weight: 900; font-size: 2.5rem; color: #ef4444; opacity: 0.1; pointer-events: none; z-index: 0; }
        .cg-1 { bottom: 10px; left: 15px; } .cg-2 { top: 10px; left: 15px; } .cg-3 { top: 10px; right: 15px; } .cg-4 { bottom: 10px; right: 15px; }

        /* ì¤‘ì•™ ì •ë³´ ë°•ìŠ¤ (í˜„í™©íŒ) */
        .center-box {
            display: flex; flex-direction: column; 
            border: 2px dashed #9ca3af; border-radius: 10px;
            width: 100%; height: 100%;
            background-color: #f9fafb;
            padding: 8px; box-sizing: border-box; overflow: hidden;
        }
        .status-header { font-size: 12px; font-weight: bold; color: #6b7280; text-align: center; margin-bottom: 5px; border-bottom: 1px solid #e5e7eb; padding-bottom: 4px; }
        .status-list { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; }
        .status-item {
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 8px 10px; border-radius: 6px; border: 1px solid #e5e7eb;
            font-size: 12px; font-weight: 600; color: #374151; cursor: pointer; transition: background 0.2s;
        }
        .status-item:hover { background-color: #eff6ff; border-color: #bfdbfe; }
        .count-badge { background-color: #e5e7eb; color: #374151; padding: 2px 8px; border-radius: 99px; font-size: 11px; font-weight: 800; }
        .status-item.active-cnt .count-badge { background-color: #ef4444; color: white; }

        /* íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ í…Œì´ë¸” */
        .history-table { width: 100%; font-size: 12px; text-align: left; }
        .history-table th { background-color: #f3f4f6; padding: 8px; font-weight: bold; color: #4b5563; }
        .history-table td { border-bottom: 1px solid #e5e7eb; padding: 8px; color: #1f2937; }
        .history-table tr:last-child td { border-bottom: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- PAGE 1: ë©”ì¸ ëª©ë¡ -->
    <div id="page-dashboard" class="page-section active p-4 max-w-md mx-auto">
        <header class="mb-6 mt-4 text-center">
            <h1 class="text-2xl font-bold text-gray-800">Soot Blower ê´€ë¦¬</h1>
            <p class="text-gray-500 text-sm">ì‘ì—…í•  êµ¬ì—­(Group)ì„ ì„ íƒí•˜ì„¸ìš”</p>
        </header>
        <div class="mb-8">
            <h2 class="text-xs font-bold text-blue-600 uppercase tracking-wider mb-3 pl-1 border-b border-blue-200 pb-1">Short Soot Blower (G1 ~ G4.5)</h2>
            <div id="list-short"></div>
        </div>
        <div>
            <h2 class="text-xs font-bold text-red-600 uppercase tracking-wider mb-3 pl-1 border-b border-red-200 pb-1">Long Soot Blower (G5 ~ G9)</h2>
            <div id="list-long"></div>
        </div>
    </div>

    <!-- PAGE 2: ìƒì„¸ ë°°ì¹˜ë„ -->
    <div id="page-detail" class="page-section p-2 max-w-xl mx-auto h-screen flex flex-col">
        <div class="bg-white p-3 rounded-xl shadow-sm mb-4 flex items-center justify-between sticky top-2 z-20">
            <button onclick="goHome()" class="flex items-center text-gray-600 font-bold hover:bg-gray-100 px-3 py-2 rounded-lg transition-colors">â—€ ë’¤ë¡œê°€ê¸°</button>
            <div class="text-right">
                <h2 id="detail-title" class="font-bold text-lg text-gray-800">GROUP 1</h2>
                <p id="detail-desc" class="text-xs text-gray-500">7F Bottom Area</p>
            </div>
        </div>
        <div id="detail-container" class="flex-1 flex flex-col justify-center pb-10"></div>
    </div>

    <!-- ì…ë ¥ ëª¨ë‹¬ -->
    <div id="actionModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden transform scale-100 border border-gray-200">
            <div class="p-4 bg-gray-800 text-white">
                <div class="flex justify-between items-center">
                    <div><h3 class="font-bold text-xl" id="modalTitle">No. 88</h3><p class="text-gray-300 text-sm" id="modalSubtitle">Group 6</p></div>
                    <div class="bg-white text-gray-800 rounded px-2 py-1 text-xs font-bold">ì„ íƒë¨</div>
                </div>
            </div>
            <div class="p-4 grid grid-cols-2 gap-3">
                <button onclick="submitAction('ì¼€ì´ë¸” êµì²´', 'F')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">ğŸ”Œ ì¼€ì´ë¸” êµì²´</button>
                <button onclick="submitAction('íŒ¨í‚¹ êµì²´', 'Le')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">ğŸ”§ íŒ¨í‚¹ êµì²´</button>
                <button onclick="submitAction('ë¦¬ë¯¸íŠ¸ ì¡°ì •', 'L')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">âš¡ ë¦¬ë¯¸íŠ¸ ì¡°ì •</button>
                <button onclick="submitAction('ì˜¤ì¼ ë³´ì¶©', 'P')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">ğŸ’§ ì˜¤ì¼ ë³´ì¶©</button>
                <button onclick="submitAction('ì‘ë™ ì ê²€', 'Pa')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">âœ… ì‘ë™ ì ê²€</button>
                <button onclick="submitAction('Poppet V/V', 'Le')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">ğŸ”© Poppet ì •ë¹„</button>
                <button onclick="submitAction('Gear Box', 'F')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">âš™ï¸ ê¸°ì–´ë°•ìŠ¤</button>
                <button onclick="submitAction('Lance Tube', 'F')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700">ğŸ“ ë€ìŠ¤ íŠœë¸Œ</button>
                <button onclick="submitAction('ê¸°íƒ€ ì •ë¹„', 'F')" class="p-3 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 font-bold text-gray-700 col-span-2">ğŸ“ ê¸°íƒ€ ì •ë¹„ ì…ë ¥</button>
            </div>
            <div class="bg-gray-50 p-3 text-right border-t"><button onclick="closeModal('actionModal')" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded font-bold text-sm">ë‹«ê¸°</button></div>
        </div>
    </div>

    <!-- ìƒì„¸ ì´ë ¥ ëª¨ë‹¬ -->
    <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-[60] p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden flex flex-col max-h-[80vh]">
            <div class="p-4 bg-blue-600 text-white flex justify-between items-center">
                <h3 class="font-bold text-lg" id="historyTitle">ì •ë¹„ ì´ë ¥</h3>
                <button onclick="closeModal('historyModal')" class="text-white text-2xl font-bold">&times;</button>
            </div>
            <div class="flex-1 overflow-y-auto p-0">
                <table class="history-table">
                    <thead><tr><th>ë‚ ì§œ</th><th>ê¸°ê¸°</th><th>ë‚´ìš©</th></tr></thead>
                    <tbody id="historyListBody"></tbody>
                </table>
                <div id="noHistoryMsg" class="hidden p-8 text-center text-gray-500 text-sm">ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
            <div class="bg-gray-50 p-3 text-right border-t"><button onclick="closeModal('historyModal')" class="px-4 py-2 bg-gray-200 text-gray-800 rounded font-bold text-sm">ë‹«ê¸°</button></div>
        </div>
    </div>

    <!-- ë¡œë”© -->
    <div id="loadingOverlay" class="fixed inset-0 hidden items-center justify-center z-[70] bg-black bg-opacity-40">
        <div class="bg-white px-8 py-5 rounded-xl shadow-2xl flex flex-col items-center">
            <div class="animate-spin text-4xl mb-2">â³</div>
            <span class="font-bold text-gray-800">ì²˜ë¦¬ ì¤‘...</span>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜…â˜…â˜… [í•„ìˆ˜] ë³µì‚¬í•œ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ URLì„ ì•„ë˜ ë”°ì˜´í‘œ ì•ˆì— ë„£ìœ¼ì„¸ìš” â˜…â˜…â˜…â˜…â˜…
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyJgKM4gfPmd3qHx7XuuazUENcOKMvQ_oBZ_6HpVOzV1WeHYMjbglkxSQ_pMB2BRno/exec";

        // ë¶„ë¥˜ ì¹´í…Œê³ ë¦¬ ì •ì˜
        const STATUS_CATEGORIES = [
            { code: 'F', label: 'Forward Fault', name: 'Forward Fault' },
            { code: 'P', label: 'Protection', name: 'Protection' },
            { code: 'L', label: 'Limit', name: 'Limit' },
            { code: 'Le', label: 'Leak (ê¸°ê³„)', name: 'Leak' },
            { code: 'Pa', label: 'Passing (ê¸°ê³„)', name: 'Passing' }
        ];

        // ì…ë ¥ ë²„íŠ¼ê³¼ ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (ìë™ ë¶„ë¥˜ìš©)
        function getCategoryByAction(actionName) {
            if (actionName.includes('ì¼€ì´ë¸”') || actionName.includes('Gear') || actionName.includes('Lance') || actionName.includes('ê¸°íƒ€')) return 'F';
            if (actionName.includes('ì˜¤ì¼')) return 'P';
            if (actionName.includes('ë¦¬ë¯¸íŠ¸')) return 'L';
            if (actionName.includes('íŒ¨í‚¹') || actionName.includes('Poppet')) return 'Le';
            if (actionName.includes('ì‘ë™')) return 'Pa';
            return 'F';
        }

        // â˜…â˜…â˜… ë°ì´í„° ì„¤ì • (ëª¨ë“  ì¸µë³„ ìˆ˜ì • ì™„ë£Œ) â˜…â˜…â˜…
        const SECTIONS = [
            { id: "short", title: "Short SB", theme: "theme-short", color: "bg-blue-600", groups: [
                { name: "GROUP 1 (7F)", desc: "Bottom Area", devices: [{no:3,pos:'left'},{no:2,pos:'left'},{no:1,pos:'left'},{no:10,pos:'top'},{no:11,pos:'top'},{no:12,pos:'top'},{no:9,pos:'right'},{no:8,pos:'right'},{no:7,pos:'right'},{no:6,pos:'bottom'},{no:5,pos:'bottom'},{no:4,pos:'bottom'}] },
                { name: "GROUP 2 (7.5F)", desc: "Lower Area", devices: [{no:13,pos:'left'},{no:14,pos:'left'},{no:15,pos:'left'},{no:16,pos:'left'},{no:17,pos:'left'},{no:32,pos:'top'},{no:31,pos:'top'},{no:30,pos:'top'},{no:29,pos:'top'},{no:28,pos:'top'},{no:23,pos:'right'},{no:24,pos:'right'},{no:25,pos:'right'},{no:26,pos:'right'},{no:27,pos:'right'},{no:18,pos:'bottom'},{no:19,pos:'bottom'},{no:20,pos:'bottom'},{no:21,pos:'bottom'},{no:22,pos:'bottom'}] },
                { name: "GROUP 3 (8F)", desc: "Middle Area", devices: [{no:37,pos:'left'},{no:36,pos:'left'},{no:35,pos:'left'},{no:34,pos:'left'},{no:33,pos:'left'},{no:48,pos:'top'},{no:49,pos:'top'},{no:50,pos:'top'},{no:51,pos:'top'},{no:52,pos:'top'},{no:47,pos:'right'},{no:46,pos:'right'},{no:45,pos:'right'},{no:44,pos:'right'},{no:43,pos:'right'},{no:42,pos:'bottom'},{no:41,pos:'bottom'},{no:40,pos:'bottom'},{no:39,pos:'bottom'},{no:38,pos:'bottom'}] },
                { name: "GROUP 4 (8.5F)", desc: "Upper Area", devices: [{no:53,pos:'left'},{no:54,pos:'left'},{no:55,pos:'left'},{no:56,pos:'left'},{no:57,pos:'left'},{no:72,pos:'top'},{no:71,pos:'top'},{no:70,pos:'top'},{no:69,pos:'top'},{no:68,pos:'top'},{no:63,pos:'right'},{no:64,pos:'right'},{no:65,pos:'right'},{no:66,pos:'right'},{no:67,pos:'right'},{no:58,pos:'bottom'},{no:59,pos:'bottom'},{no:60,pos:'bottom'},{no:61,pos:'bottom'},{no:62,pos:'bottom'}] },
                { name: "GROUP 4.5 (9F)", desc: "NS Series", devices: [{no:'NS1',pos:'left'},{no:'NS2',pos:'left'},{no:'NS3',pos:'left'},{no:'NS4',pos:'left'},{no:'NS20',pos:'top'},{no:'NS19',pos:'top'},{no:'NS18',pos:'top'},{no:'NS17',pos:'top'},{no:'NS16',pos:'top'},{no:'NS14',pos:'right'},{no:'NS13',pos:'right'},{no:'NS12',pos:'right'},{no:'NS11',pos:'right'},{no:'NS6',pos:'bottom'},{no:'NS7',pos:'bottom'},{no:'NS8',pos:'bottom'},{no:'NS9',pos:'bottom'},{no:'NS10',pos:'bottom'}] }
            ]},
            { id: "long", title: "Long SB", theme: "theme-long", color: "bg-red-600", groups: [
                { name: "GROUP 5 (10F)", desc: "Middle Section 1", devices: [{no:74,pos:'left'},{no:128,pos:'left'},{no:76,pos:'left'},{no:124,pos:'left'},{no:78,pos:'left'},{no:73,pos:'right'},{no:127,pos:'right'},{no:75,pos:'right'},{no:123,pos:'right'},{no:77,pos:'right'}] },
                { name: "GROUP 5.5 (10.5F)", desc: "Middle Section 2", devices: [{no:86,pos:'left'},{no:84,pos:'left'},{no:'NL2',pos:'left'},{no:82,pos:'left'},{no:80,pos:'left'},{no:85,pos:'right'},{no:83,pos:'right'},{no:'NL1',pos:'right'},{no:81,pos:'right'},{no:79,pos:'right'}] },
                { name: "GROUP 6 (11F)", desc: "Upper Middle", devices: [{no:88,pos:'left'},{no:90,pos:'left'},{no:92,pos:'left'},{no:94,pos:'left'},{no:96,pos:'left'},{no:87,pos:'right'},{no:89,pos:'right'},{no:91,pos:'right'},{no:93,pos:'right'},{no:95,pos:'right'}] },
                { name: "GROUP 7 (12F)", desc: "Upper Section", devices: [{no:104,pos:'left'},{no:102,pos:'left'},{no:'NL4',pos:'left'},{no:100,pos:'left'},{no:98,pos:'left'},{no:103,pos:'right'},{no:101,pos:'right'},{no:'NL3',pos:'right'},{no:99,pos:'right'},{no:97,pos:'right'}] },
                { name: "GROUP 8 (13F)", desc: "High Section 1", devices: [{no:106,pos:'left'},{no:108,pos:'left'},{no:110,pos:'left'},{no:112,pos:'left'},{no:'NL6',pos:'left'},{no:105,pos:'right'},{no:107,pos:'right'},{no:109,pos:'right'},{no:111,pos:'right'},{no:'NL5',pos:'right'}] },
                { name: "GROUP 8.5 (14F)", desc: "High Section 2", devices: [{no:122,pos:'left'},{no:120,pos:'left'},{no:118,pos:'left'},{no:116,pos:'left'},{no:114,pos:'left'},{no:121,pos:'right'},{no:119,pos:'right'},{no:117,pos:'right'},{no:115,pos:'right'},{no:113,pos:'right'}] },
                { name: "GROUP 9 (ECO - 12F)", desc: "Economizer Lower", devices: [{no:130,pos:'left'},{no:132,pos:'left'},{no:134,pos:'left'},{no:129,pos:'right'},{no:131,pos:'right'},{no:133,pos:'right'}] },
                { name: "GROUP 9.5 (ECO - 13F)", desc: "Economizer Upper", devices: [{no:'NL8',pos:'left'},{no:126,pos:'left'},{no:'NL10',pos:'left'},{no:'NL7',pos:'right'},{no:125,pos:'right'},{no:'NL9',pos:'right'}] }
            ]}
        ];

        let currentSelection = { group: null, deviceNo: null };
        let currentGroupData = [];

        function initDashboard() {
            SECTIONS.forEach(section => {
                const listEl = document.getElementById(section.id === 'short' ? 'list-short' : 'list-long');
                section.groups.forEach((group, idx) => {
                    const btn = document.createElement('div');
                    const colorClass = section.id === 'short' ? 'blue' : 'red';
                    const textColor = section.id === 'short' ? 'text-blue-600' : 'text-red-600';
                    btn.className = `dashboard-btn ${colorClass}`;
                    btn.innerHTML = `<div><div class="font-bold text-lg text-gray-800">${group.name}</div><div class="text-xs text-gray-400">${group.desc}</div></div><div class="${textColor} font-bold text-2xl">â”</div>`;
                    btn.onclick = () => showDetail(section.id, idx);
                    listEl.appendChild(btn);
                });
            });
        }

        function showDetail(sectionId, groupIdx) {
            const section = SECTIONS.find(s => s.id === sectionId);
            const group = section.groups[groupIdx];
            
            document.getElementById('detail-title').textContent = group.name;
            document.getElementById('detail-desc').textContent = group.desc;
            const container = document.getElementById('detail-container');
            container.innerHTML = '';

            const boilerGrid = document.createElement('div');
            boilerGrid.className = `boiler-grid`;
            // ì½”ë„ˆ ê°€ì´ë“œ (1~4ë²ˆ)
            boilerGrid.innerHTML = `<span class="corner-guide cg-1">1</span><span class="corner-guide cg-2">2</span><span class="corner-guide cg-3">3</span><span class="corner-guide cg-4">4</span>`;

            // â˜… ì¤‘ì•™ ì •ë³´ ë°•ìŠ¤ (í˜„í™©íŒ) â˜…
            const centerInfo = document.createElement('div');
            centerInfo.className = "area-center center-box";
            centerInfo.innerHTML = `<div class="flex items-center justify-center h-full text-gray-400 text-xs"><div class="animate-spin mr-2">â³</div>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
            boilerGrid.appendChild(centerInfo);

            // ë°ì´í„° ë¡œë“œ
            fetchGroupData(group.name, centerInfo);

            // êµ¬ì—­ ìƒì„±
            const areas = {};
            ['top','bottom','left','right'].forEach(pos => {
                const div = document.createElement('div');
                div.className = `area-${pos} device-container`;
                boilerGrid.appendChild(div);
                areas[pos] = div;
            });

            // ê¸°ê¸° ë²„íŠ¼ ìƒì„±
            let innerContainer = null;
            group.devices.forEach(device => {
                const btn = document.createElement('button');
                btn.className = `btn-device`;
                let content = '';
                const strNo = String(device.no);
                if (strNo.startsWith('NS') || strNo.startsWith('NL')) {
                    const type = strNo.substring(0,2); const num = strNo.substring(2);
                    content = `<span class="ns-label">${type}</span><span class="ns-number">${num}</span>`;
                } else { content = `<span class="text-lg">${strNo}</span>`; }
                btn.innerHTML = content;
                btn.onclick = () => openModal(group.name, device.no);

                if (device.pos === 'inner') {
                    if (!innerContainer) {
                        innerContainer = document.createElement('div');
                        innerContainer.className = "flex flex-wrap justify-center gap-2 mt-2";
                        centerInfo.appendChild(innerContainer);
                    }
                    innerContainer.appendChild(btn);
                } else if (areas[device.pos]) areas[device.pos].appendChild(btn);
            });

            container.appendChild(boilerGrid);
            document.getElementById('page-dashboard').classList.remove('active');
            document.getElementById('page-detail').classList.add('active');
            window.scrollTo(0,0);
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function fetchGroupData(groupName, containerEl) {
            if(GOOGLE_SCRIPT_URL.includes("ì—¬ê¸°ì—")) {
                containerEl.innerHTML = `<div class="text-center text-xs text-red-500">URL ë¯¸ì„¤ì •<br>ë°ì´í„° ë¡œë“œ ë¶ˆê°€</div>`;
                return;
            }
            fetch(`${GOOGLE_SCRIPT_URL}?group=${encodeURIComponent(groupName)}`)
                .then(res => res.json())
                .then(data => {
                    currentGroupData = data;
                    updateCenterStatus(containerEl, data);
                })
                .catch(err => {
                    console.error(err);
                    containerEl.innerHTML = `<div class="text-center text-xs text-gray-400">ë°ì´í„° ì—†ìŒ<br>(ë¡œë“œ ì‹¤íŒ¨)</div>`;
                });
        }

        // ì¤‘ì•™ í˜„í™©íŒ ì—…ë°ì´íŠ¸
        function updateCenterStatus(containerEl, data) {
            const counts = { 'F':0, 'P':0, 'L':0, 'Le':0, 'Pa':0 };
            data.forEach(item => {
                const cat = getCategoryByAction(item.action);
                if (counts[cat] !== undefined) counts[cat]++;
            });
            let html = `<div class="status-header">ì •ë¹„ í˜„í™©</div><div class="status-list">`;
            STATUS_CATEGORIES.forEach((cat, idx) => {
                const count = counts[cat.code] || 0;
                const activeClass = count > 0 ? 'active-cnt' : '';
                html += `<div class="status-item ${activeClass}" onclick="openHistoryModal('${cat.code}')"><span>${idx+1}. ${cat.code}-${cat.name}</span><span class="count-badge">${count}ê±´</span></div>`;
            });
            html += `</div>`;
            containerEl.innerHTML = html;
        }

        // ì´ë ¥ ëª¨ë‹¬
        function openHistoryModal(categoryCode) {
            const catInfo = STATUS_CATEGORIES.find(c => c.code === categoryCode);
            document.getElementById('historyTitle').textContent = `${catInfo.label} ì´ë ¥`;
            const listBody = document.getElementById('historyListBody');
            const noMsg = document.getElementById('noHistoryMsg');
            listBody.innerHTML = '';
            const filtered = currentGroupData.filter(item => getCategoryByAction(item.action) === categoryCode);
            if (filtered.length === 0) { noMsg.classList.remove('hidden'); } 
            else {
                noMsg.classList.add('hidden');
                filtered.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${item.date.substring(5)}</td><td>No.${item.device}</td><td>${item.action}</td>`;
                    listBody.appendChild(row);
                });
            }
            document.getElementById('historyModal').classList.remove('hidden');
            document.getElementById('historyModal').classList.add('flex');
        }

        function goHome() { document.getElementById('page-detail').classList.remove('active'); document.getElementById('page-dashboard').classList.add('active'); }
        function openModal(g, d) { currentSelection = { group: g, deviceNo: d }; document.getElementById('modalTitle').textContent = `No. ${d}`; document.getElementById('modalSubtitle').textContent = g; document.getElementById('actionModal').classList.remove('hidden'); document.getElementById('actionModal').classList.add('flex'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); document.getElementById(id).classList.remove('flex'); }
        
        function submitAction(action, cat) {
            if(!currentSelection.group) return;
            const loading = document.getElementById('loadingOverlay');
            loading.classList.remove('hidden'); loading.classList.add('flex');
            closeModal('actionModal');
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST", mode: "no-cors",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({group: currentSelection.group, deviceNo: currentSelection.deviceNo, action: action})
            }).then(() => {
                loading.classList.add('hidden'); loading.classList.remove('flex');
                alert(`[${currentSelection.deviceNo} - ${action}] ì €ì¥ ì™„ë£Œ!`);
                const centerBox = document.querySelector('.center-box');
                if(centerBox) fetchGroupData(currentSelection.group, centerBox);
            }).catch(() => {
                loading.classList.add('hidden'); loading.classList.remove('flex');
                alert("ì „ì†¡ ì‹¤íŒ¨");
            });
        }

        initDashboard();
    </script>
</body>
</html>